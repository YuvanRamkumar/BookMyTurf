generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  password_hash String?
  role          Role      @default(USER)
  is_approved   Boolean   @default(false)
  created_at    DateTime  @default(now())
  bookings      Booking[]
  reviews       Review[]
  turfs         Turf[]    @relation("AdminTurfs")
}

model Turf {
  id                   String         @id @default(uuid())
  name                 String
  location             String
  description          String?
  amenities            String[]       @default([])
  precautions          String[]       @default([])
  images               String[]       @default([])
  sport_type           SportType
  price_per_hour       Float
  weekday_price        Float          @default(1000)
  weekend_price        Float          @default(1200)
  peak_hour_multiplier Float          @default(1.2)
  latitude             Float          @default(0)
  longitude            Float          @default(0)
  address              String         @default("")
  opening_time         String
  closing_time         String
  image_url            String?
  admin_id             String
  created_at           DateTime       @default(now())
  status               ApprovalStatus @default(PENDING)
  operational_status   TurfStatus     @default(ACTIVE)
  peak_end_time        String         @default("21:00")
  peak_start_time      String         @default("18:00")
  bookings             Booking[]
  reviews              Review[]
  slots                Slot[]
  admin                User           @relation("AdminTurfs", fields: [admin_id], references: [id])
}

model Review {
  id         String   @id @default(uuid())
  user_id    String
  turf_id    String
  rating     Int
  comment    String
  created_at DateTime @default(now())
  turf       Turf     @relation(fields: [turf_id], references: [id])
  user       User     @relation(fields: [user_id], references: [id])
}

model Slot {
  id         String   @id @default(uuid())
  turf_id    String
  date       DateTime @db.Date
  start_time String
  end_time   String
  is_booked  Boolean  @default(false)
  created_at DateTime @default(now())
  booking    Booking?
  turf       Turf     @relation(fields: [turf_id], references: [id], onDelete: Cascade)

  @@unique([turf_id, date, start_time, end_time])
  @@index([date])
  @@index([turf_id])
}

model Booking {
  id                  String        @id @default(uuid())
  user_id             String
  turf_id             String
  slot_id             String        @unique
  status              BookingStatus @default(PENDING)
  razorpay_order_id   String
  razorpay_payment_id String?
  created_at          DateTime      @default(now())
  slot                Slot          @relation(fields: [slot_id], references: [id])
  turf                Turf          @relation(fields: [turf_id], references: [id])
  user                User          @relation(fields: [user_id], references: [id])
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SportType {
  FOOTBALL_CRICKET
  PICKLEBALL
}

enum BookingStatus {
  PENDING
  CONFIRMED
  FAILED
}

enum TurfStatus {
  ACTIVE
  MAINTENANCE
  CLOSED
}

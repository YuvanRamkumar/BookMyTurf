generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum SportType {
  FOOTBALL_CRICKET
  PICKLEBALL
}

enum BookingStatus {
  PENDING
  CONFIRMED
  FAILED
}

model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  password_hash String
  role          Role      @default(USER)
  is_approved   Boolean   @default(false)
  created_at    DateTime  @default(now())
  
  turfs         Turf[]    @relation("AdminTurfs")
  bookings      Booking[]
}

model Turf {
  id             String    @id @default(uuid())
  name           String
  location       String
  sport_type     SportType
  price_per_hour Float
  opening_time   String    // e.g., "06:00"
  closing_time   String    // e.g., "22:00"
  image_url      String?
  admin_id       String
  admin          User      @relation("AdminTurfs", fields: [admin_id], references: [id])
  created_at     DateTime  @default(now())
  
  slots          Slot[]
  bookings       Booking[]
}

model Slot {
  id         String   @id @default(uuid())
  turf_id    String
  turf       Turf     @relation(fields: [turf_id], references: [id], onDelete: Cascade)
  date       DateTime @db.Date
  start_time String   // e.g., "09:00"
  end_time   String   // e.g., "10:00"
  is_booked  Boolean  @default(false)
  created_at DateTime @default(now())
  
  booking    Booking?

  @@index([date])
  @@index([turf_id])
  @@unique([turf_id, date, start_time, end_time])
}

model Booking {
  id                  String        @id @default(uuid())
  user_id             String
  user                User          @relation(fields: [user_id], references: [id])
  turf_id             String
  turf                Turf          @relation(fields: [turf_id], references: [id])
  slot_id             String        @unique
  slot                Slot          @relation(fields: [slot_id], references: [id])
  status              BookingStatus @default(PENDING)
  razorpay_order_id   String        @unique
  razorpay_payment_id String?
  created_at          DateTime      @default(now())
}
